{"ast":null,"code":"import { useRef, useState } from 'react';\nimport { flushSync } from 'react-dom';\nimport { mergeRefs, useDidUpdate } from '@mantine/hooks';\nvar __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\n\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {\n  enumerable: true,\n  configurable: true,\n  writable: true,\n  value\n}) : obj[key] = value;\n\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {})) if (__hasOwnProp.call(b, prop)) __defNormalProp(a, prop, b[prop]);\n\n  if (__getOwnPropSymbols) for (var prop of __getOwnPropSymbols(b)) {\n    if (__propIsEnum.call(b, prop)) __defNormalProp(a, prop, b[prop]);\n  }\n  return a;\n};\n\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\n\nvar __objRest = (source, exclude) => {\n  var target = {};\n\n  for (var prop in source) if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0) target[prop] = source[prop];\n\n  if (source != null && __getOwnPropSymbols) for (var prop of __getOwnPropSymbols(source)) {\n    if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop)) target[prop] = source[prop];\n  }\n  return target;\n};\n\nfunction getAutoHeightDuration(height) {\n  if (!height || typeof height === \"string\") {\n    return 0;\n  }\n\n  const constant = height / 36;\n  return Math.round((4 + 15 * constant ** 0.25 + constant / 5) * 10);\n}\n\nfunction getElementHeight(el) {\n  return (el == null ? void 0 : el.current) ? el.current.scrollHeight : \"auto\";\n}\n\nconst raf = typeof window !== \"undefined\" && window.requestAnimationFrame;\n\nfunction useCollapse({\n  transitionDuration,\n  transitionTimingFunction = \"ease\",\n  onTransitionEnd = () => {},\n  opened\n}) {\n  const el = useRef(null);\n  const collapsedHeight = \"0px\";\n  const collapsedStyles = {\n    display: \"none\",\n    height: \"0px\",\n    overflow: \"hidden\"\n  };\n  const [styles, setStylesRaw] = useState(opened ? {} : collapsedStyles);\n\n  const setStyles = newStyles => {\n    flushSync(() => setStylesRaw(newStyles));\n  };\n\n  const mergeStyles = newStyles => {\n    setStyles(oldStyles => __spreadValues(__spreadValues({}, oldStyles), newStyles));\n  };\n\n  function getTransitionStyles(height) {\n    const _duration = transitionDuration || getAutoHeightDuration(height);\n\n    return {\n      transition: `height ${_duration}ms ${transitionTimingFunction}`\n    };\n  }\n\n  useDidUpdate(() => {\n    if (opened) {\n      raf(() => {\n        mergeStyles({\n          willChange: \"height\",\n          display: \"block\",\n          overflow: \"hidden\"\n        });\n        raf(() => {\n          const height = getElementHeight(el);\n          mergeStyles(__spreadProps(__spreadValues({}, getTransitionStyles(height)), {\n            height\n          }));\n        });\n      });\n    } else {\n      raf(() => {\n        const height = getElementHeight(el);\n        mergeStyles(__spreadProps(__spreadValues({}, getTransitionStyles(height)), {\n          willChange: \"height\",\n          height\n        }));\n        raf(() => mergeStyles({\n          height: collapsedHeight,\n          overflow: \"hidden\"\n        }));\n      });\n    }\n  }, [opened]);\n\n  const handleTransitionEnd = e => {\n    if (e.target !== el.current || e.propertyName !== \"height\") {\n      return;\n    }\n\n    if (opened) {\n      const height = getElementHeight(el);\n\n      if (height === styles.height) {\n        setStyles({});\n      } else {\n        mergeStyles({\n          height\n        });\n      }\n\n      onTransitionEnd();\n    } else if (styles.height === collapsedHeight) {\n      setStyles(collapsedStyles);\n      onTransitionEnd();\n    }\n  };\n\n  function getCollapseProps(_a = {}) {\n    var _b = _a,\n        {\n      style = {},\n      refKey = \"ref\"\n    } = _b,\n        rest = __objRest(_b, [\"style\", \"refKey\"]);\n\n    const theirRef = rest[refKey];\n    return __spreadProps(__spreadValues({\n      \"aria-hidden\": !opened\n    }, rest), {\n      [refKey]: mergeRefs(el, theirRef),\n      onTransitionEnd: handleTransitionEnd,\n      style: __spreadValues(__spreadValues({\n        boxSizing: \"border-box\"\n      }, style), styles)\n    });\n  }\n\n  return getCollapseProps;\n}\n\nexport { getElementHeight, useCollapse };","map":{"version":3,"sources":["../../src/Collapse/use-collapse.ts"],"names":[],"mappings":"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","sourcesContent":["import React, { useState, useRef } from 'react';\nimport { flushSync } from 'react-dom';\nimport { useDidUpdate, mergeRefs } from '@mantine/hooks';\n\nfunction getAutoHeightDuration(height: number | string) {\n  if (!height || typeof height === 'string') {\n    return 0;\n  }\n  const constant = height / 36;\n  return Math.round((4 + 15 * constant ** 0.25 + constant / 5) * 10);\n}\n\nexport function getElementHeight(\n  el: React.RefObject<HTMLElement> | { current?: { scrollHeight: number } }\n) {\n  return el?.current ? el.current.scrollHeight : 'auto';\n}\n\nconst raf = typeof window !== 'undefined' && window.requestAnimationFrame;\n\ninterface UseCollapse {\n  opened: boolean;\n  transitionDuration?: number;\n  transitionTimingFunction?: string;\n  onTransitionEnd?: () => void;\n}\n\ninterface GetCollapseProps {\n  [key: string]: unknown;\n  style?: React.CSSProperties;\n  onTransitionEnd?: (e: TransitionEvent) => void;\n  refKey?: string;\n  ref?: React.MutableRefObject<HTMLDivElement> | ((node: HTMLDivElement) => void);\n}\n\nexport function useCollapse({\n  transitionDuration,\n  transitionTimingFunction = 'ease',\n  onTransitionEnd = () => {},\n  opened,\n}: UseCollapse): (props: GetCollapseProps) => Record<string, any> {\n  const el = useRef<HTMLElement | null>(null);\n  const collapsedHeight = '0px';\n  const collapsedStyles = {\n    display: 'none',\n    height: '0px',\n    overflow: 'hidden',\n  };\n  const [styles, setStylesRaw] = useState<React.CSSProperties>(opened ? {} : collapsedStyles);\n  const setStyles = (newStyles: {} | ((oldStyles: {}) => {})): void => {\n    flushSync(() => setStylesRaw(newStyles));\n  };\n\n  const mergeStyles = (newStyles: {}): void => {\n    setStyles((oldStyles) => ({ ...oldStyles, ...newStyles }));\n  };\n\n  function getTransitionStyles(height: number | string): {\n    transition: string;\n  } {\n    const _duration = transitionDuration || getAutoHeightDuration(height);\n    return {\n      transition: `height ${_duration}ms ${transitionTimingFunction}`,\n    };\n  }\n\n  useDidUpdate(() => {\n    if (opened) {\n      raf(() => {\n        mergeStyles({ willChange: 'height', display: 'block', overflow: 'hidden' });\n        raf(() => {\n          const height = getElementHeight(el);\n          mergeStyles({ ...getTransitionStyles(height), height });\n        });\n      });\n    } else {\n      raf(() => {\n        const height = getElementHeight(el);\n        mergeStyles({ ...getTransitionStyles(height), willChange: 'height', height });\n        raf(() => mergeStyles({ height: collapsedHeight, overflow: 'hidden' }));\n      });\n    }\n  }, [opened]);\n\n  const handleTransitionEnd = (e: React.TransitionEvent): void => {\n    if (e.target !== el.current || e.propertyName !== 'height') {\n      return;\n    }\n\n    if (opened) {\n      const height = getElementHeight(el);\n\n      if (height === styles.height) {\n        setStyles({});\n      } else {\n        mergeStyles({ height });\n      }\n\n      onTransitionEnd();\n    } else if (styles.height === collapsedHeight) {\n      setStyles(collapsedStyles);\n      onTransitionEnd();\n    }\n  };\n\n  function getCollapseProps({ style = {}, refKey = 'ref', ...rest }: GetCollapseProps = {}) {\n    const theirRef: any = rest[refKey];\n    return {\n      'aria-hidden': !opened,\n      ...rest,\n      [refKey]: mergeRefs(el, theirRef),\n      onTransitionEnd: handleTransitionEnd,\n      style: { boxSizing: 'border-box', ...style, ...styles },\n    };\n  }\n\n  return getCollapseProps;\n}\n"]},"metadata":{},"sourceType":"module"}